import { readFileSync } from 'fs';

// æ‰‹å‹•è®€å– .env.local
const envFile = readFileSync('.env.local', 'utf8');
const env = {};
envFile.split('\n').forEach(line => {
  const [key, ...values] = line.split('=');
  if (key) {
    // ç§»é™¤å€¼ä¸­çš„æ›è¡Œç¬¦è™Ÿå’Œå¼•è™Ÿ
    env[key.trim()] = values.join('=').trim().replace(/\\n|"|'/g, '');
  }
});

const NOTION_API_KEY = env.NOTION_TOKEN;
const PRODUCTS_DATABASE_ID = env.NOTION_PRODUCTS_DATABASE_ID;
const NOTION_VERSION = '2022-06-28';

console.log('ğŸ”‘ ç’°å¢ƒè®Šæ•¸æª¢æŸ¥:');
console.log('NOTION_TOKEN:', NOTION_API_KEY?.substring(0, 10) + '...');
console.log('PRODUCTS_DB_ID:', PRODUCTS_DATABASE_ID);

// ç¬¬å…­èª²çš„ page_idï¼ˆéœ€è¦å…ˆæŸ¥è©¢ï¼‰
const COURSE_6_PAGE_ID = await getCourse6PageId();

const YOU_WILL_LEARN = `âš¡ è¶…é‡è¦ï¼é€™æ˜¯ã€Œæ‰‹æ©Ÿèª²ç¨‹ã€

âœ… ä½ åªéœ€è¦å¸¶ï¼š
â€¢ ä½ çš„æ‰‹æ©Ÿï¼ˆiOS/Android éƒ½å¯ä»¥ï¼‰
â€¢ å……é›»ç·š + è¡Œå‹•é›»æº
â€¢ ä¸€é¡†æƒ³å­¸ç¿’çš„å¿ƒ

âŒ ä½ ä¸éœ€è¦ï¼š
â€¢ ç­†é›»ï¼ˆçœŸçš„ä¸ç”¨ï¼ï¼‰
â€¢ å¯«ç¨‹å¼ï¼ˆå®Œå…¨ä¸ç”¨ï¼ï¼‰
â€¢ ä»»ä½•æŠ€è¡“èƒŒæ™¯

ğŸ’¡ ç‚ºä»€éº¼ç”¨æ‰‹æ©Ÿï¼Ÿ
å› ç‚ºä½ å¹³å¸¸å°±æ˜¯ç”¨æ‰‹æ©Ÿç¶“ç‡Ÿè‡ªåª’é«”ï¼Œç›´æ¥å­¸æœƒåœ¨æ‰‹æ©Ÿä¸Šæ“ä½œï¼Œå›å®¶ç«‹åˆ»èƒ½ç”¨ï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ Day 1ï¼šAI å…§å®¹å‰µä½œèƒ½åŠ›
â€¢ æ‰‹æ©Ÿå°±èƒ½ç”Ÿæˆå°ˆæ¥­åœ–æ–‡
â€¢ 10 åˆ†é˜å®Œæˆä»¥å‰ 1 å°æ™‚çš„å·¥ä½œ
â€¢ å»ºç«‹å°ˆå±¬çš„å€‹äººé¢¨æ ¼æ¨¡æ¿
â€¢ ç”¢å‡º 5 å¼µå¯ç›´æ¥ç™¼å¸ƒçš„ IG è²¼åœ–

âœ“ Day 2ï¼šæ‰¹é‡ç”Ÿç”¢ + è‡ªå‹•åŒ–äº’å‹•
â€¢ 30 åˆ†é˜ç”¢å‡ºä¸€é€±å®Œæ•´ç´ æ
â€¢ å»ºç«‹ ManyChat è‡ªå‹•ç§è¨Šæ©Ÿåˆ¶
â€¢ è¨­è¨ˆå¾ç™¼æ–‡åˆ°è½‰æ›çš„äº’å‹•æ¼æ–—
â€¢ ç”¨ AI åˆ†ææ•¸æ“šå„ªåŒ–å…§å®¹ç­–ç•¥

âœ“ Day 3ï¼šå°ˆå±¬ AI å·¥å…·åŒ…
â€¢ æ‰“é€ å€‹äºº AI åŠ©æ‰‹ç¶²é 
â€¢ ä¸€éµç”Ÿæˆæ–‡æ¡ˆ / åœ–ç‰‡ / hashtag
â€¢ ç™¼å¸ƒåˆ° GitHub Pagesï¼ˆå…¨ç¨‹æ‰‹æ©Ÿæ“ä½œï¼‰
â€¢ å»ºç«‹å¯é‡è¤‡ä½¿ç”¨çš„ prompt ç”¢ç”Ÿå™¨`;

const SUMMERY = `ä¸‰å¤© 18 å°æ™‚å¯†é›†åŸ¹è¨“ï¼Œæ•´åˆ Course 05-11 å…± 7 é–€èª²ç¨‹ã€‚å¾ AI åŸºç¤åˆ°è‡ªåª’é«”ç¶“ç‡Ÿï¼Œå¾å…§å®¹å‰µä½œåˆ°è‡ªå‹•åŒ–äº’å‹•ï¼Œè®“ä½ ç”¨ 3 å¤©å»ºç«‹å®Œæ•´çš„ AI è‡ªåª’é«”å·¥ä½œæµã€‚

ğŸ¯ é€™å ‚èª²é©åˆèª°ï¼Ÿ

âœ… å®Œç¾é©åˆï¼š
â€¢ è‡ªåª’é«”å‰µä½œè€…ï¼ˆIG/FB/Threads/YouTubeï¼‰
â€¢ æƒ³ç¶“ç‡Ÿå€‹äººå“ç‰Œçš„ä¸Šç­æ—
â€¢ å°ç·¨ã€è¡ŒéŠ·ã€å…¬é—œäººå“¡
â€¢ æƒ³ç”¨ AI æå‡æ•ˆç‡çš„è‡ªç”±å·¥ä½œè€…
â€¢ æ¯å¤©ç™¼æ–‡ä½†æˆæ•ˆä¸ä½³çš„äºº

âŒ ä¸é©åˆï¼š
â€¢ æƒ³å­¸å¯«ç¨‹å¼çš„äººï¼ˆé€™ä¸æ˜¯ç¨‹å¼èª²ï¼‰
â€¢ æƒ³å­¸æŠ€è¡“çˆ¬èŸ²çš„äººï¼ˆé€™æ˜¯è‡ªåª’é«”èª²ï¼‰
â€¢ æ²’æœ‰ç¶“ç‡Ÿè‡ªåª’é«”éœ€æ±‚çš„äºº

ğŸ’¡ é›¶åŸºç¤å¯å­¸ï¼ä¸éœ€è¦ä»»ä½•æŠ€è¡“èƒŒæ™¯ï¼Œåªè¦ä½ æœƒç”¨æ‰‹æ©Ÿå°±èƒ½ä¸Šèª²

ğŸ“± ä½ æœƒåšå‡ºé€™äº›æˆæœï¼š
Day 1ï¼šåœ–æ–‡ä¸¦èŒ‚çš„ç¤¾ç¾¤è²¼æ–‡ï¼ˆå«å€‹äººé¢¨æ ¼æ¨¡æ¿ï¼‰
Day 2ï¼šä¸€é€±å®Œæ•´ç´ æ + è‡ªå‹•åŒ–äº’å‹•æ©Ÿåˆ¶
Day 3ï¼šå°ˆå±¬ AI å·¥å…·åŒ…ç¶²é ï¼ˆä¸€éµç”Ÿæˆæ–‡æ¡ˆ/åœ–ç‰‡ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… ç¬¬ä¸€å¤©ï¼šAI å”ä½œåŸºç¤èˆ‡å…§å®¹å‰µä½œï¼ˆ6 å°æ™‚ï¼‰

09:30-11:00 | Course 05: AI æ–°æ‰‹æ‘ï¼ˆ1.5 å°æ™‚ï¼‰
â€¢ å­¸æœƒå’Œ AI æºé€šï¼Œå»ºç«‹æ­£ç¢ºçš„å”ä½œæ€ç¶­
â€¢ æŒæ¡ ChatGPTã€Claudeã€Gemini ä¸‰å¤§å·¥å…·
â€¢ 3 å¥è©±è®“ AI åšå‡ºä½ è¦çš„æ±è¥¿
â€¢ âœ… å¯¦ä½œï¼šç”¨æ‰‹æ©Ÿç”Ÿæˆä¸€ç¯‡å®Œæ•´è²¼æ–‡

11:10-12:40 | Course 06: å¯«ä½œæ•‘æ˜Ÿï¼ˆ1.5 å°æ™‚ï¼‰
â€¢ ç”¨ AI å¯«å‡ºå¸å¼•äººçš„æ–‡æ¡ˆ
â€¢ æŒæ¡ 5 ç¨®è¬ç”¨æ–‡æ¡ˆå…¬å¼ï¼ˆAIDAã€æ•…äº‹ã€ç—›é»è§£æ±ºï¼‰
â€¢ 10 åˆ†é˜ç”¢å‡ºä»¥å‰è¦èŠ± 1 å°æ™‚çš„å…§å®¹
â€¢ âœ… å¯¦ä½œï¼šå¯«å‡º 3 ç¨®ä¸åŒé¢¨æ ¼çš„ç”¢å“æ–‡æ¡ˆ

12:40-13:40 | åˆé¤ä¼‘æ¯

13:40-15:10 | Course 07: æ‰¾åˆ°ä½ çš„é¢¨æ ¼ï¼ˆ1.5 å°æ™‚ï¼‰
â€¢ ç™¼æ˜ä½ çš„éš±è—ç‰¹è‰²èˆ‡ç¨ç‰¹åƒ¹å€¼
â€¢ è®“ AI å­¸æœƒä½ çš„é¢¨æ ¼ï¼Œä½†ä¸å¤±å»å€‹æ€§
â€¢ åœ¨ AI æ™‚ä»£ä¿æŒä¸å¯æ›¿ä»£æ€§
â€¢ âœ… å¯¦ä½œï¼šå»ºç«‹å°ˆå±¬çš„ã€Œå€‹äººé¢¨æ ¼ prompt æ¨¡æ¿ã€

15:20-16:30 | Course 08: åœ–ç‰‡é­”æ³•å¸«ï¼ˆ1 å°æ™‚ 10 åˆ†ï¼‰
â€¢ ç”¨ ChatGPTï¼ˆDALL-E 3ï¼‰å’Œ Gemini åšå‡ºå°ˆæ¥­ç¾åœ–
â€¢ Logoã€ç¤¾ç¾¤åœ–ã€Reels å°é¢ï¼Œæ‰‹æ©Ÿå°±èƒ½ç”Ÿæˆ
â€¢ å»ºç«‹å°ˆå±¬çš„è¦–è¦ºå“ç‰Œé¢¨æ ¼
â€¢ âœ… å¯¦ä½œï¼šç”¢å‡º 5 å¼µå¯ç›´æ¥ç™¼å¸ƒçš„ IG è²¼åœ–

ğŸ“… ç¬¬äºŒå¤©ï¼šæ‰¹é‡ç”Ÿç”¢èˆ‡è‡ªå‹•åŒ–äº’å‹•ï¼ˆ6 å°æ™‚ï¼‰

09:30-11:00 | Course 09: å…§å®¹è£½é€ æ©Ÿï¼ˆ1.5 å°æ™‚ï¼‰
â€¢ å»ºç«‹å…§å®¹è£½é€ æµæ°´ç·š
â€¢ ç”¨ä¸€å€‹é»å­è®Šå‡º 10 ç¨®ä¸åŒå…§å®¹ï¼ˆIG/FB/Threads/LinkedInï¼‰
â€¢ 30 åˆ†é˜åšå‡ºä¸€é€±çš„ç¤¾ç¾¤ç™¼æ–‡
â€¢ âœ… å¯¦ä½œï¼šç¾å ´ç”¢å‡ºä¸€é€±å®Œæ•´ç¤¾ç¾¤å…§å®¹ï¼ˆåœ– + æ–‡ï¼‰

11:10-13:10 | ManyChat è‡ªå‹•åŒ–äº’å‹•è¨­è¨ˆï¼ˆ2 å°æ™‚ï¼‰
â€¢ è¨­è¨ˆè‡ªåª’é«”äº’å‹•æ¼æ–—ï¼ˆè²¼æ–‡â†’ç•™è¨€â†’ç§è¨Šâ†’è½‰æ›ï¼‰
â€¢ å»ºç«‹ Reels/Post ç•™è¨€è‡ªå‹•ç§è¨Šæ©Ÿåˆ¶
â€¢ è¨­è¨ˆæ­¡è¿è¨Šæ¯ã€é—œéµå­—è‡ªå‹•å›è¦†
â€¢ âœ… å¯¦ä½œï¼šå»ºç«‹ä½ çš„ç¬¬ä¸€å€‹è‡ªå‹•åŒ–äº’å‹•æµç¨‹

13:10-14:10 | åˆé¤ä¼‘æ¯

14:10-16:30 | Course 10+11: AI æ±ºç­–èˆ‡æ•¸æ“šåˆ†æï¼ˆ2 å°æ™‚ 20 åˆ†ï¼‰
â€¢ ç”¨ AI ç•¶ä½ çš„è‡ªåª’é«”ç­–ç•¥é¡§å•
â€¢ è¤‡è£½ IG/FB å¾Œå°æ•¸æ“šçµ¦ ChatGPT åˆ†æ
â€¢ æ‰¾å‡ºé«˜äº’å‹•å…§å®¹çš„å…±åŒç‰¹å¾µ
â€¢ å„ªåŒ–ä¸‹ä¸€ç¯‡çˆ†æ¬¾å…§å®¹
â€¢ âœ… å¯¦ä½œï¼šåˆ†æä½ çš„å¸³è™Ÿæ•¸æ“šï¼Œæ‰¾å‡ºå„ªåŒ–æ–¹å‘

ğŸ“… ç¬¬ä¸‰å¤©ï¼šå·¥å…·åŒ…å»ºç«‹èˆ‡ç³»çµ±æ•´åˆï¼ˆ6 å°æ™‚ï¼‰

09:30-12:30 | å€‹äºº AI å·¥å…·åŒ…è£½ä½œï¼ˆ3 å°æ™‚ï¼‰
â€¢ ç”¨ Claude ç”Ÿæˆä½ çš„å°ˆå±¬å·¥å…·ç¶²é 
â€¢ å»ºç«‹å¯é‡è¤‡ä½¿ç”¨çš„ prompt ç”¢ç”Ÿå™¨
â€¢ æ‰“é€ ä¸€éµç”Ÿæˆã€Œé€±å ±/æ–‡æ¡ˆ/hashtagã€çš„æŒ‰éˆ•
â€¢ ç™¼å¸ƒåˆ° GitHub Pages æˆç‚ºä½ çš„å€‹äººé é¢
â€¢ âœ… å¯¦ä½œï¼šå®Œæˆå°ˆå±¬çš„ AI åŠ©æ‰‹å·¥å…·åŒ…ï¼ˆå…¨ç¨‹æ‰‹æ©Ÿæ“ä½œï¼‰

12:30-13:30 | åˆé¤ä¼‘æ¯

13:30-15:30 | å·¥ä½œæµå±•ç¤ºèˆ‡å„ªåŒ–ï¼ˆ2 å°æ™‚ï¼‰
â€¢ å­¸å“¡å±•ç¤ºå€‹äººè‡ªåª’é«”å·¥ä½œæµ
â€¢ è¬›å¸«é»è©•ï¼šå…§å®¹ç­–ç•¥ã€è¦–è¦ºé¢¨æ ¼ã€äº’å‹•è¨­è¨ˆ
â€¢ äº’ç›¸å­¸ç¿’ä¸åŒç”¢æ¥­çš„è‡ªåª’é«”ç¶“ç‡Ÿæ–¹å¼
â€¢ å„ªåŒ–å»ºè­°ï¼šå¾ç™¼æ–‡åˆ°è®Šç¾çš„å®Œæ•´è·¯å¾‘

15:40-16:30 | èª²ç¨‹ç¸½çµèˆ‡æœªä¾†è¦åŠƒï¼ˆ50 åˆ†é˜ï¼‰
â€¢ å¾å…§å®¹åˆ°äº’å‹•åˆ°å·¥å…·çš„å®Œæ•´å›é¡§
â€¢ å»ºç«‹ä½ çš„è‡ªåª’é«” AI å”ä½œ SOP
â€¢ èª²å¾Œè³‡æºï¼šprompt ç¯„æœ¬åº«ã€æ¡ˆä¾‹åƒè€ƒ
â€¢ LINE ç¤¾ç¾¤æ”¯æ´èˆ‡æŒçºŒå­¸ç¿’è³‡æº

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ èª²å¾Œä½ æœƒæ“æœ‰ï¼š
âœ… å€‹äººé¢¨æ ¼ prompt æ¨¡æ¿åº«
âœ… ä¸€é€±ä»½å¯ç™¼å¸ƒçš„ç¤¾ç¾¤å…§å®¹
âœ… è‡ªå‹•åŒ–ç§è¨Šäº’å‹•æ©Ÿåˆ¶
âœ… å°ˆå±¬ AI å·¥å…·åŒ…ç¶²é 
âœ… å®Œæ•´çš„è‡ªåª’é«”ç¶“ç‡Ÿ SOP
âœ… LINE ç¤¾ç¾¤æŒçºŒæ”¯æ´`;

// æŸ¥è©¢ç¬¬å…­èª²çš„ page_id
async function getCourse6PageId() {
  const response = await fetch(`https://api.notion.com/v1/databases/${PRODUCTS_DATABASE_ID}/query`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${NOTION_API_KEY}`,
      'Notion-Version': NOTION_VERSION,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      page_size: 100
    })
  });

  const data = await response.json();

  // Debug: æª¢æŸ¥ API å›æ‡‰çµæ§‹
  if (!response.ok) {
    console.error('âŒ API éŒ¯èª¤:', JSON.stringify(data, null, 2));
    throw new Error(`Notion API failed: ${data.message || 'Unknown error'}`);
  }

  console.log('\nğŸ“‹ æ‰€æœ‰èª²ç¨‹ï¼š');
  if (!data.results) {
    console.error('âŒ æ²’æœ‰ results æ¬„ä½:', JSON.stringify(data, null, 2));
    throw new Error('API å›æ‡‰æ ¼å¼ä¸æ­£ç¢º');
  }

  data.results.forEach(page => {
    const courseId = page.properties.course_id?.number;
    const name = page.properties.zh_name?.rich_text?.[0]?.plain_text;
    console.log(`  - course_id: ${courseId}, name: ${name}`);
  });

  const course6 = data.results.find(page => page.properties.course_id?.number === 6);

  if (!course6) {
    throw new Error('æ‰¾ä¸åˆ°ç¬¬å…­èª² (course_id = 6)');
  }

  return course6.id;
}

// æ›´æ–° Notion é é¢
async function updateCourse6() {
  console.log('ğŸ” æŸ¥è©¢ç¬¬å…­èª² page_id...');
  console.log('ğŸ“„ Page ID:', COURSE_6_PAGE_ID);

  console.log('\nğŸ“ æ›´æ–°èª²ç¨‹å…§å®¹...');

  const response = await fetch(`https://api.notion.com/v1/pages/${COURSE_6_PAGE_ID}`, {
    method: 'PATCH',
    headers: {
      'Authorization': `Bearer ${NOTION_API_KEY}`,
      'Notion-Version': NOTION_VERSION,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      properties: {
        you_will_learn: {
          rich_text: [{
            type: 'text',
            text: { content: YOU_WILL_LEARN }
          }]
        },
        summery: {
          rich_text: [{
            type: 'text',
            text: { content: SUMMERY }
          }]
        }
      }
    })
  });

  if (!response.ok) {
    const error = await response.text();
    throw new Error(`æ›´æ–°å¤±æ•—: ${error}`);
  }

  console.log('âœ… æ›´æ–°æˆåŠŸï¼');
  console.log('\nğŸ“Š æ›´æ–°å…§å®¹ï¼š');
  console.log('- you_will_learn: å·²æ›´æ–°ï¼ˆä¸‰å¤©èª²ç¨‹æ¶æ§‹ï¼‰');
  console.log('- summery: å·²æ›´æ–°ï¼ˆè©³ç´°èª²è¡¨ï¼‰');
}

// åŸ·è¡Œ
try {
  await updateCourse6();
} catch (error) {
  console.error('âŒ éŒ¯èª¤:', error.message);
  process.exit(1);
}
