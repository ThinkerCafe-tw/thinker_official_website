# Requirements: Email Notification System

**Feature**: email-notification-system
**Project**: thinker-official-website
**Status**: ✅ Completed
**Created**: 2025-11-02

---

## 1. Problem Statement

### 背景
- 官網只提供銀行轉帳付款方式
- 學員報名後沒有任何通知或確認
- 轉帳資訊容易遺忘或搞錯
- **結果：完全沒有人報名**

### 根本原因分析
1. **信任問題**：沒有 Email 確認，學員不確定報名是否成功
2. **體驗問題**：需要手動記錄轉帳資訊，容易出錯
3. **提醒問題**：沒有繳費期限提醒，可能錯過

---

## 2. Goals & Success Criteria

### Primary Goals
1. **提升報名轉換率**：從 0% 提升到至少有人報名
2. **建立信任感**：透過專業 Email 確認報名成功
3. **降低客服成本**：自動提供繳費資訊，減少詢問

### Success Metrics
- ✅ Email 發送成功率 > 95%
- ✅ Email 開信率 > 40%（行業標準）
- ✅ 學員完成繳費時間 < 12 小時
- ✅ 客服詢問「如何繳費」的次數下降 > 80%

---

## 3. User Stories

### US-1: 學員收到報名確認信
**As a** 學員
**I want to** 在報名後立即收到確認 Email
**So that** 我知道報名成功，並獲得繳費資訊

**Acceptance Criteria**:
- [ ] 報名後 10 秒內收到 Email
- [ ] Email 包含訂單編號、課程名稱、金額
- [ ] Email 包含完整轉帳資訊（銀行、帳號）
- [ ] Email 有明確的繳費期限（24 小時）
- [ ] Email 有返回付款頁面的連結

### US-2: 學員輕鬆完成轉帳
**As a** 學員
**I want to** 快速複製銀行資訊並完成轉帳
**So that** 我不會輸入錯誤或遺忘資訊

**Acceptance Criteria**:
- [x] 一鍵複製銀行代碼（007）
- [x] 一鍵複製帳號（32110060407）
- [x] 顯示倒數計時器（24 小時）
- [x] 可填寫帳號後五碼（協助驗證）
- [x] 可填寫轉帳時間（協助對帳）

### US-3: 管理員驗證繳費
**As a** 管理員
**I want to** 快速確認學員是否完成繳費
**So that** 我可以及時開通課程權限

**Acceptance Criteria**:
- [x] 資料庫記錄帳號後五碼
- [x] 資料庫記錄轉帳時間
- [x] 可在後台查看訂單狀態

---

## 4. Functional Requirements

### FR-1: Email 發送系統
- **FR-1.1**: 使用 Resend 作為 Email 服務商
- **FR-1.2**: 寄件者為 `onboarding@updates.thinker.cafe`
- **FR-1.3**: Email 使用 React Email 渲染 HTML
- **FR-1.4**: Email 包含品牌 logo 和設計風格
- **FR-1.5**: Email 包含 plaintext fallback

### FR-2: Email 內容
- **FR-2.1**: 標題：「【思考者咖啡】您的報名序號 #{orderId}，請完成繳費」
- **FR-2.2**: 顯示學員姓名（個人化）
- **FR-2.3**: 顯示課程名稱（格式化）
- **FR-2.4**: 顯示訂單編號
- **FR-2.5**: 顯示金額（NT$）
- **FR-2.6**: 顯示繳費期限（具體日期時間）
- **FR-2.7**: 顯示銀行帳戶資訊
- **FR-2.8**: 提供「查看訂單」按鈕（CTA）

### FR-3: 付款頁面優化
- **FR-3.1**: 複製按鈕（銀行代碼、帳號）
- **FR-3.2**: 倒數計時器（24 小時）
- **FR-3.3**: 輸入欄位（帳號後五碼、轉帳時間）
- **FR-3.4**: Toast 提示（複製成功、表單送出）
- **FR-3.5**: 響應式設計（手機友好）

### FR-4: 資料追蹤
- **FR-4.1**: 記錄 Email 發送狀態（成功/失敗）
- **FR-4.2**: 記錄學員填寫的帳號後五碼
- **FR-4.3**: 記錄學員填寫的轉帳時間
- **FR-4.4**: 記錄訂單建立時間
- **FR-4.5**: 記錄繳費期限

---

## 5. Non-Functional Requirements

### NFR-1: Performance
- Email 發送時間 < 5 秒
- 付款頁面載入時間 < 2 秒
- 複製按鈕響應時間 < 100ms

### NFR-2: Reliability
- Email 發送成功率 > 99%
- 系統可用性 > 99.9%
- 錯誤處理：Email 失敗不影響訂單建立

### NFR-3: Security
- Email 內容不包含敏感資訊（如密碼）
- API endpoint 需要驗證（未來實作）
- 環境變數加密儲存

### NFR-4: Usability
- Email 在所有主流 Email client 正常顯示
- 付款頁面支援所有現代瀏覽器
- 移動端體驗流暢

### NFR-5: Maintainability
- Email 模板使用 React 組件（易於修改）
- 環境變數集中管理
- 完整的錯誤日誌

---

## 6. Technical Requirements

### TR-1: Tech Stack
- **Framework**: Next.js 15.2.4 (App Router)
- **Email Service**: Resend
- **Email Template**: React Email (@react-email/components)
- **Database**: Supabase (PostgreSQL)
- **Hosting**: Vercel

### TR-2: Dependencies
```json
{
  "resend": "^6.4.0",
  "@react-email/components": "^0.5.7"
}
```

### TR-3: Environment Variables
```bash
RESEND_API_KEY=xxx
RESEND_FROM_EMAIL=onboarding@updates.thinker.cafe
SITE_URL=https://thinker.cafe
```

### TR-4: Database Schema
```sql
ALTER TABLE orders ADD COLUMN transfer_account_last5 VARCHAR(5);
ALTER TABLE orders ADD COLUMN transfer_time TIMESTAMP WITH TIME ZONE;
```

---

## 7. Constraints & Assumptions

### Constraints
- Resend 免費額度：3,000 封 Email/月
- 必須在 Vercel 部署（hardcode fallback）
- 需要驗證自有網域才能使用 @thinker.cafe

### Assumptions
- 學員都有 Email 地址（Supabase Auth 必填）
- 學員會檢查 Email（開信率 > 40%）
- 繳費期限 24 小時是合理的

---

## 8. Dependencies

### External Services
- ✅ Resend 帳號已申請
- ✅ `updates.thinker.cafe` 網域已驗證
- ✅ DKIM/SPF 已設定

### Internal Systems
- ✅ Supabase 已設定
- ✅ Orders table 已存在
- ✅ Profiles table 已存在
- ✅ Notion API 已整合

---

## 9. Out of Scope (Future Work)

### Phase 2 (藍新金流整合)
- 線上信用卡付款
- ATM 虛擬帳號
- 超商代碼繳費

### Phase 3 (進階功能)
- Email 模板 A/B testing
- 繳費提醒（24h 前、12h 前）
- WhatsApp/LINE 通知整合
- Email 開信/點擊追蹤

---

## 10. Approval

**Requirements Approved**: ✅ Yes
**Approved By**: Cruz
**Approval Date**: 2025-11-02
**Notes**: 緊急任務，邊做邊調整，實作已完成後補文檔

---

**Generated by**: Claude Code
**Last Updated**: 2025-11-02
